<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game 2D — simples</title>
    <style>
        /* Tela cheia */
        html,
        body {
            height: 100%;
        }

        body {
            margin: 0;
            background: #111;
        }

        #stage {
            width: 100vw;
            height: 100vh;
            background: #222;
            position: relative;
            overflow: hidden;
        }

        /* Sprite básico (32x32) */
        .sprite {
            width: 32px;
            height: 32px;
            position: absolute;
            bottom: 0;
            left: 0;
            image-rendering: pixelated;
            /* nítido */
            background-repeat: no-repeat;
            transform-origin: bottom left;
        }

        /* Idle: 11 frames => 11*32 = 352px */
        .idle-humano {
            background-image: url('assets/Idle.png');
            animation: idle 1.1s steps(11) infinite;
        }

        .idle-yellow {
            background-image: url('assets/IdleYellow.png');
            animation: idle 1.1s steps(11) infinite;
        }

        @keyframes idle {
            from {
                background-position: 0 0;
            }

            to {
                background-position: -352px 0;
            }
        }

        /* Run: 12 frames => 12*32 = 384px */
        .run-humano {
            background-image: url('assets/Run.png');
            animation: run 0.8s steps(12) infinite;
        }

        .run-yellow {
            background-image: url('assets/RunYellow.png');
            animation: run 0.8s steps(12) infinite;
        }

        @keyframes run {
            from {
                background-position: 0 0;
            }

            to {
                background-position: -384px 0;
            }
        }

        #box {
            width: 64px;
            height: 64px;
            position: absolute;
            bottom: -10px;
            right: 1000px;
            background-image: url('assets/box.png');
            image-rendering: pixelated;
            background-repeat: no-repeat;
            background-size: cover;
        }
    </style>
</head>

<body>
    <div id="stage">
        <div id="hero" class="sprite" aria-label="heroi"></div>
        <div id="box"></div>
    </div>

    <script>
        const buscarHeroi = localStorage.getItem("hero")
        let idle = ""
        let run = ""

        if (buscarHeroi === "humano") {
            const hero = document.getElementById('hero');
            hero.classList.add("idle-humano")
            idle = "idle-humano"
            run = "run-humano"
        } else if (buscarHeroi === "yellow") {
            const hero = document.getElementById('hero');
            hero.classList.add("idle-yellow")
            idle = "idle-yellow"
            run = "run-yellow"
        }

        // Estado Horizontal do personagem
        const hero = document.getElementById('hero');
        const box = document.getElementById('box');
        let x = 50;           // posição horizontal
        let velocidade = 0;   // 0 parado; >0 andando
        const SCALE = 2;

        // Estado vertical do personagem
        let y = 0;             // posição vertical (0 = chão)
        let velocidadeY = 0;   // velocidade vertical
        const gravidade = 0.5; // força que puxa para baixo
        const puloForca = -8; // força do pulo
        let pulando = false;

        // Box position (left edge)
        const boxRight = 1000; // right offset in px
        const boxWidth = 32 * SCALE; // 64px
        const stageWidth = window.innerWidth;
        const boxLeft = stageWidth - boxRight - boxWidth;

        // Loop simples só para mover (animação é CSS)
        function atualizar() {
            let nextX = x + velocidade;
            if (nextX + 32 * SCALE > (boxLeft + 18)) {
                nextX = boxLeft - 32 * SCALE;
                console.log("BOX", nextX)
            }
            x = nextX;

            // gravidade + pulo
            if (pulando) {
                y += velocidadeY;
                velocidadeY += gravidade;
                if (y > 0) { // voltou ao chão
                    y = 0;
                    pulando = false;
                    velocidadeY = 0;
                }
            }

            hero.style.transform = `translate(${x}px, ${y}px) scale(${SCALE})`;
            requestAnimationFrame(atualizar);
        }
        requestAnimationFrame(atualizar);

        // Teclas: seta para a direita liga/desliga correr
        document.addEventListener('keydown', (e) => {
            if (e.code === 'ArrowRight') {
                e.preventDefault();
                hero.classList.remove(idle);
                hero.classList.add(run);
                velocidade = 2;
            }
        });

        // Espaço para pular e Seta up
        document.addEventListener('keydown', (e) => {
            console.log(e)
            if ((e.code === 'ArrowUp' && !pulando) || (e.code === 'Space' && !pulando)) {
                e.preventDefault();
                pulando = true;
                velocidadeY = puloForca;
            }
        });

        document.addEventListener('keyup', (e) => {
            if (e.code === 'ArrowRight') {
                hero.classList.remove(run);
                hero.classList.add(idle);
                velocidade = 0;
            }
        });
    </script>
</body>

</html>