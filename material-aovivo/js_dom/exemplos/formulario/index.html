<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <form id="form-cadastro">
        <label for="input-nome">Nome</label>
        <input type="text" name="nome" id="input-nome" required>

        <label for="input-email">Email</label>
        <input type="email" name="email" id="input-email">

        <label for="input-idade">Idade</label>
        <input type="number" name="idade" id="input-idade" min="1" max="120">

        <label for="input-telefone">Telefone</label>
        <input type="tel" name="telefone" id="input-telefone">

        <label for="input-telefone">Senha</label>
        <input type="password" name="senha" id="input-senha">

        <select name="genero" id="select-genero">
            <option value="mas">Masculino</option>
            <option value="fem">Femenino</option>
        </select>

        <p>Renda Familiar:</p>
        <input type="radio" name="renda" id="renda1" value="2000" checked>
        <label for="renda1">Até 2000</label>

        <input type="radio" name="renda" id="renda2" value="5000">
        <label for="renda2">Até 5000</label>

        <input type="radio" name="renda" id="renda3" value="10000">
        <label for="renda3">Até 10000</label>

        <p>Escolarida</p>
        <input type="checkbox" name="fundamental" id="input-fundamental" checked>
        <label for="input-fundamental">Ensino Fundamental</label>

        <input type="checkbox" name="medio" id="input-medio">
        <label for="input-medio">Ensino Medio</label>

        <input type="checkbox" name="superior" id="input-superior">
        <label for="input-superior">Ensino Superior</label>

        <input type="submit" value="Cadastrar">
    </form>

    <div>
        <ol id="lista-cadastro">

        </ol>

        <form hidden id="form-alterar">
            <input type="text" id="novo-nome" placeholder="alterar nome">

            <button type="submit" id="btn-alterar">Alterar</button>
        </form>
    </div>

    <script>
        window.addEventListener("load", () => {
            const formCadastro = document.getElementById("form-cadastro");
            const formAlterar = document.getElementById("form-alterar");
            const listaCadastro = document.getElementById("lista-cadastro");
            const novoNome = document.getElementById("novo-nome");
            const btnAlterar = document.getElementById("btn-alterar");

            let lsCadastros = []
            const dados = {
                nome: "",
                email: "",
                idade: "",
                senha: "",
                idade: "",
                genero: "",
                telefone: "",
                renda: "2000",
                fundamental: true,
                medio: false,
                superior: false
            };
            let nome = "";

            if (localStorage.getItem("lsCadastros")) {
                lsCadastros = JSON.parse(localStorage.getItem("lsCadastros"))

                listaCadastro.innerHTML = "";
                lsCadastros.forEach(element => {
                    listaCadastro.innerHTML += `
                    <li>
                        <p>${element.nome}</p>
                    </li>
                `
                });
            }

            formCadastro.addEventListener("change", (event) => {
                console.log(event.target.name, event.target.value);
                const name = event.target.name
                const value = event.target.value

                dados[name] = value

                if (name === "fundamental" || name === "medio" || name === "superior") {
                    dados[name] = event.target.checked
                }
            });

            formCadastro.addEventListener("submit", (event) => {
                const novosDados = { ...dados };
                lsCadastros.push(novosDados)
                localStorage.setItem("lsCadastros", JSON.stringify(lsCadastros))

                if (localStorage.getItem("lsCadastros")) {
                    const lsCadastros = JSON.parse(localStorage.getItem("lsCadastros"))

                    listaCadastro.innerHTML = "";
                    lsCadastros.forEach(element => {
                        listaCadastro.innerHTML += `
                    <li>
                        <p>${element.nome}</p>
                    </li>
                `
                    });
                }
            });

            listaCadastro.addEventListener("click", (event) => {
                event.preventDefault()
                const element = event.target
                formAlterar.hidden = false

                nome = element.textContent;
            });

            formAlterar.addEventListener("submit", () => {
                const nomeAlterar = novoNome.value; // Variavel que coleta o novo valor
                if (localStorage.getItem("lsCadastros")) { // Verificar se existe o localStorage lsCadastros
                    const lsCadastros = JSON.parse(localStorage.getItem("lsCadastros")); // Resgatmos o lsCadastros
                    const encontrarIndexNome = lsCadastros.findIndex(element => element.nome === nome) // Vai encontrar o index, de quem desejamos alterar
                    lsCadastros[encontrarIndexNome].nome = nomeAlterar // de fato altera

                    localStorage.setItem("lsCadastros", JSON.stringify(lsCadastros)) // Envia a nova base de dados para o localStorage
                    listaCadastro.innerHTML = "";
                    lsCadastros.forEach(element => {
                        listaCadastro.innerHTML += `
                    <li>
                        <p>${element.nome}</p>
                    </li>
                `
                    });
                }
            })

        });
    </script>
</body>

</html>